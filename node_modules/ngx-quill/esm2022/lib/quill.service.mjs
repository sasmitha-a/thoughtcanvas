/* eslint-disable @typescript-eslint/no-explicit-any */
import { DOCUMENT } from '@angular/common';
import { Injectable, Inject, Optional } from '@angular/core';
import { defer, firstValueFrom, isObservable } from 'rxjs';
import { shareReplay } from 'rxjs/operators';
import { defaultModules, QUILL_CONFIG_TOKEN, } from 'ngx-quill/config';
import * as i0 from "@angular/core";
export class QuillService {
    constructor(injector, config) {
        this.config = config;
        this.quill$ = defer(async () => {
            if (!this.Quill) {
                // Quill adds events listeners on import https://github.com/quilljs/quill/blob/develop/core/emitter.js#L8
                // We'd want to use the unpatched `addEventListener` method to have all event callbacks to be run outside of zone.
                // We don't know yet if the `zone.js` is used or not, just save the value to restore it back further.
                const maybePatchedAddEventListener = this.document.addEventListener;
                // There're 2 types of Angular applications:
                // 1) zone-full (by default)
                // 2) zone-less
                // The developer can avoid importing the `zone.js` package and tells Angular that he/she is responsible for running
                // the change detection by himself. This is done by "nooping" the zone through `CompilerOptions` when bootstrapping
                // the root module. We fallback to `document.addEventListener` if `__zone_symbol__addEventListener` is not defined,
                // this means the `zone.js` is not imported.
                // The `__zone_symbol__addEventListener` is basically a native DOM API, which is not patched by zone.js, thus not even going
                // through the `zone.js` task lifecycle. You can also access the native DOM API as follows `target[Zone.__symbol__('methodName')]`.
                this.document.addEventListener =
                    // eslint-disable-next-line @typescript-eslint/dot-notation
                    this.document['__zone_symbol__addEventListener'] ||
                        this.document.addEventListener;
                const quillImport = await import('quill');
                this.document.addEventListener = maybePatchedAddEventListener;
                this.Quill = (
                // seems like esmodules have nested "default"
                quillImport.default?.default ?? quillImport.default ?? quillImport);
            }
            // Only register custom options and modules once
            this.config.customOptions?.forEach((customOption) => {
                const newCustomOption = this.Quill.import(customOption.import);
                newCustomOption.whitelist = customOption.whitelist;
                this.Quill.register(newCustomOption, true, this.config.suppressGlobalRegisterWarning);
            });
            return await this.registerCustomModules(this.Quill, this.config.customModules, this.config.suppressGlobalRegisterWarning);
        }).pipe(shareReplay({ bufferSize: 1, refCount: true }));
        this.document = injector.get(DOCUMENT);
        if (!this.config) {
            this.config = { modules: defaultModules };
        }
    }
    getQuill() {
        return this.quill$;
    }
    /**
     * Marked as internal so it won't be available for `ngx-quill` consumers, this is only
     * internal method to be used within the library.
     *
     * @internal
     */
    async registerCustomModules(Quill, customModules, suppressGlobalRegisterWarning) {
        if (Array.isArray(customModules)) {
            // eslint-disable-next-line prefer-const
            for (let { implementation, path } of customModules) {
                // The `implementation` might be an observable that resolves the actual implementation,
                // e.g. if it should be lazy loaded.
                if (isObservable(implementation)) {
                    implementation = await firstValueFrom(implementation);
                }
                Quill.register(path, implementation, suppressGlobalRegisterWarning);
            }
        }
        // Return `Quill` constructor so we'll be able to re-use its return value except of using
        // `map` operators, etc.
        return Quill;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.5", ngImport: i0, type: QuillService, deps: [{ token: i0.Injector }, { token: QUILL_CONFIG_TOKEN, optional: true }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.3.5", ngImport: i0, type: QuillService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.5", ngImport: i0, type: QuillService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: () => [{ type: i0.Injector }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [QUILL_CONFIG_TOKEN]
                }] }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVpbGwuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1xdWlsbC9zcmMvbGliL3F1aWxsLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsdURBQXVEO0FBQ3ZELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQTtBQUMxQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBWSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFDdEUsT0FBTyxFQUFFLEtBQUssRUFBRSxjQUFjLEVBQUUsWUFBWSxFQUFjLE1BQU0sTUFBTSxDQUFBO0FBQ3RFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQTtBQUU1QyxPQUFPLEVBQ0wsY0FBYyxFQUNkLGtCQUFrQixHQUduQixNQUFNLGtCQUFrQixDQUFBOztBQUt6QixNQUFNLE9BQU8sWUFBWTtJQWtEdkIsWUFDRSxRQUFrQixFQUM2QixNQUFtQjtRQUFuQixXQUFNLEdBQU4sTUFBTSxDQUFhO1FBaEQ1RCxXQUFNLEdBQW9CLEtBQUssQ0FBQyxLQUFLLElBQUksRUFBRTtZQUNqRCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUNoQix5R0FBeUc7Z0JBQ3pHLGtIQUFrSDtnQkFDbEgscUdBQXFHO2dCQUNyRyxNQUFNLDRCQUE0QixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUE7Z0JBQ25FLDRDQUE0QztnQkFDNUMsNEJBQTRCO2dCQUM1QixlQUFlO2dCQUNmLG1IQUFtSDtnQkFDbkgsbUhBQW1IO2dCQUNuSCxtSEFBbUg7Z0JBQ25ILDRDQUE0QztnQkFDNUMsNEhBQTRIO2dCQUM1SCxtSUFBbUk7Z0JBQ25JLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCO29CQUM1QiwyREFBMkQ7b0JBQzNELElBQUksQ0FBQyxRQUFRLENBQUMsaUNBQWlDLENBQUM7d0JBQ2hELElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUE7Z0JBQ2hDLE1BQU0sV0FBVyxHQUFHLE1BQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFBO2dCQUN6QyxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixHQUFHLDRCQUE0QixDQUFBO2dCQUU3RCxJQUFJLENBQUMsS0FBSyxHQUFHO2dCQUNYLDZDQUE2QztnQkFDNUMsV0FBVyxDQUFDLE9BQWUsRUFBRSxPQUFPLElBQUksV0FBVyxDQUFDLE9BQU8sSUFBSSxXQUFXLENBQ3JFLENBQUE7WUFDVixDQUFDO1lBRUQsZ0RBQWdEO1lBQ2hELElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDLFlBQVksRUFBRSxFQUFFO2dCQUNsRCxNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUE7Z0JBQzlELGVBQWUsQ0FBQyxTQUFTLEdBQUcsWUFBWSxDQUFDLFNBQVMsQ0FBQTtnQkFDbEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQ2pCLGVBQWUsRUFDZixJQUFJLEVBQ0osSUFBSSxDQUFDLE1BQU0sQ0FBQyw2QkFBNkIsQ0FDMUMsQ0FBQTtZQUNILENBQUMsQ0FBQyxDQUFBO1lBRUYsT0FBTyxNQUFNLElBQUksQ0FBQyxxQkFBcUIsQ0FDckMsSUFBSSxDQUFDLEtBQUssRUFDVixJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFDekIsSUFBSSxDQUFDLE1BQU0sQ0FBQyw2QkFBNkIsQ0FDMUMsQ0FBQTtRQUNILENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxVQUFVLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFNckQsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBRXRDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDakIsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsQ0FBQTtRQUMzQyxDQUFDO0lBQ0gsQ0FBQztJQUVELFFBQVE7UUFDTixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUE7SUFDcEIsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsS0FBSyxDQUFDLHFCQUFxQixDQUN6QixLQUFVLEVBQ1YsYUFBeUMsRUFDekMsNkJBQXVDO1FBRXZDLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDO1lBQ2pDLHdDQUF3QztZQUN4QyxLQUFLLElBQUksRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLElBQUksYUFBYSxFQUFFLENBQUM7Z0JBQ25ELHVGQUF1RjtnQkFDdkYsb0NBQW9DO2dCQUNwQyxJQUFJLFlBQVksQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO29CQUNqQyxjQUFjLEdBQUcsTUFBTSxjQUFjLENBQUMsY0FBYyxDQUFDLENBQUE7Z0JBQ3ZELENBQUM7Z0JBQ0QsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsY0FBYyxFQUFFLDZCQUE2QixDQUFDLENBQUE7WUFDckUsQ0FBQztRQUNILENBQUM7UUFFRCx5RkFBeUY7UUFDekYsd0JBQXdCO1FBQ3hCLE9BQU8sS0FBSyxDQUFBO0lBQ2QsQ0FBQzs4R0EzRlUsWUFBWSwwQ0FvREQsa0JBQWtCO2tIQXBEN0IsWUFBWSxjQUZYLE1BQU07OzJGQUVQLFlBQVk7a0JBSHhCLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25COzswQkFxREksUUFBUTs7MEJBQUksTUFBTTsyQkFBQyxrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovXG5pbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbidcbmltcG9ydCB7IEluamVjdGFibGUsIEluamVjdCwgSW5qZWN0b3IsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSdcbmltcG9ydCB7IGRlZmVyLCBmaXJzdFZhbHVlRnJvbSwgaXNPYnNlcnZhYmxlLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcydcbmltcG9ydCB7IHNoYXJlUmVwbGF5IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnXG5cbmltcG9ydCB7XG4gIGRlZmF1bHRNb2R1bGVzLFxuICBRVUlMTF9DT05GSUdfVE9LRU4sXG4gIFF1aWxsQ29uZmlnLFxuICBDdXN0b21Nb2R1bGUsXG59IGZyb20gJ25neC1xdWlsbC9jb25maWcnXG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxufSlcbmV4cG9ydCBjbGFzcyBRdWlsbFNlcnZpY2Uge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25hbWluZy1jb252ZW50aW9uXG4gIHByaXZhdGUgUXVpbGwhOiBhbnlcbiAgcHJpdmF0ZSBkb2N1bWVudDogRG9jdW1lbnRcbiAgcHJpdmF0ZSBxdWlsbCQ6IE9ic2VydmFibGU8YW55PiA9IGRlZmVyKGFzeW5jICgpID0+IHtcbiAgICBpZiAoIXRoaXMuUXVpbGwpIHtcbiAgICAgIC8vIFF1aWxsIGFkZHMgZXZlbnRzIGxpc3RlbmVycyBvbiBpbXBvcnQgaHR0cHM6Ly9naXRodWIuY29tL3F1aWxsanMvcXVpbGwvYmxvYi9kZXZlbG9wL2NvcmUvZW1pdHRlci5qcyNMOFxuICAgICAgLy8gV2UnZCB3YW50IHRvIHVzZSB0aGUgdW5wYXRjaGVkIGBhZGRFdmVudExpc3RlbmVyYCBtZXRob2QgdG8gaGF2ZSBhbGwgZXZlbnQgY2FsbGJhY2tzIHRvIGJlIHJ1biBvdXRzaWRlIG9mIHpvbmUuXG4gICAgICAvLyBXZSBkb24ndCBrbm93IHlldCBpZiB0aGUgYHpvbmUuanNgIGlzIHVzZWQgb3Igbm90LCBqdXN0IHNhdmUgdGhlIHZhbHVlIHRvIHJlc3RvcmUgaXQgYmFjayBmdXJ0aGVyLlxuICAgICAgY29uc3QgbWF5YmVQYXRjaGVkQWRkRXZlbnRMaXN0ZW5lciA9IHRoaXMuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lclxuICAgICAgLy8gVGhlcmUncmUgMiB0eXBlcyBvZiBBbmd1bGFyIGFwcGxpY2F0aW9uczpcbiAgICAgIC8vIDEpIHpvbmUtZnVsbCAoYnkgZGVmYXVsdClcbiAgICAgIC8vIDIpIHpvbmUtbGVzc1xuICAgICAgLy8gVGhlIGRldmVsb3BlciBjYW4gYXZvaWQgaW1wb3J0aW5nIHRoZSBgem9uZS5qc2AgcGFja2FnZSBhbmQgdGVsbHMgQW5ndWxhciB0aGF0IGhlL3NoZSBpcyByZXNwb25zaWJsZSBmb3IgcnVubmluZ1xuICAgICAgLy8gdGhlIGNoYW5nZSBkZXRlY3Rpb24gYnkgaGltc2VsZi4gVGhpcyBpcyBkb25lIGJ5IFwibm9vcGluZ1wiIHRoZSB6b25lIHRocm91Z2ggYENvbXBpbGVyT3B0aW9uc2Agd2hlbiBib290c3RyYXBwaW5nXG4gICAgICAvLyB0aGUgcm9vdCBtb2R1bGUuIFdlIGZhbGxiYWNrIHRvIGBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyYCBpZiBgX196b25lX3N5bWJvbF9fYWRkRXZlbnRMaXN0ZW5lcmAgaXMgbm90IGRlZmluZWQsXG4gICAgICAvLyB0aGlzIG1lYW5zIHRoZSBgem9uZS5qc2AgaXMgbm90IGltcG9ydGVkLlxuICAgICAgLy8gVGhlIGBfX3pvbmVfc3ltYm9sX19hZGRFdmVudExpc3RlbmVyYCBpcyBiYXNpY2FsbHkgYSBuYXRpdmUgRE9NIEFQSSwgd2hpY2ggaXMgbm90IHBhdGNoZWQgYnkgem9uZS5qcywgdGh1cyBub3QgZXZlbiBnb2luZ1xuICAgICAgLy8gdGhyb3VnaCB0aGUgYHpvbmUuanNgIHRhc2sgbGlmZWN5Y2xlLiBZb3UgY2FuIGFsc28gYWNjZXNzIHRoZSBuYXRpdmUgRE9NIEFQSSBhcyBmb2xsb3dzIGB0YXJnZXRbWm9uZS5fX3N5bWJvbF9fKCdtZXRob2ROYW1lJyldYC5cbiAgICAgIHRoaXMuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciA9XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvZG90LW5vdGF0aW9uXG4gICAgICAgIHRoaXMuZG9jdW1lbnRbJ19fem9uZV9zeW1ib2xfX2FkZEV2ZW50TGlzdGVuZXInXSB8fFxuICAgICAgICB0aGlzLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXJcbiAgICAgIGNvbnN0IHF1aWxsSW1wb3J0ID0gYXdhaXQgaW1wb3J0KCdxdWlsbCcpXG4gICAgICB0aGlzLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgPSBtYXliZVBhdGNoZWRBZGRFdmVudExpc3RlbmVyXG5cbiAgICAgIHRoaXMuUXVpbGwgPSAoXG4gICAgICAgIC8vIHNlZW1zIGxpa2UgZXNtb2R1bGVzIGhhdmUgbmVzdGVkIFwiZGVmYXVsdFwiXG4gICAgICAgIChxdWlsbEltcG9ydC5kZWZhdWx0IGFzIGFueSk/LmRlZmF1bHQgPz8gcXVpbGxJbXBvcnQuZGVmYXVsdCA/PyBxdWlsbEltcG9ydFxuICAgICAgKSBhcyBhbnlcbiAgICB9XG5cbiAgICAvLyBPbmx5IHJlZ2lzdGVyIGN1c3RvbSBvcHRpb25zIGFuZCBtb2R1bGVzIG9uY2VcbiAgICB0aGlzLmNvbmZpZy5jdXN0b21PcHRpb25zPy5mb3JFYWNoKChjdXN0b21PcHRpb24pID0+IHtcbiAgICAgIGNvbnN0IG5ld0N1c3RvbU9wdGlvbiA9IHRoaXMuUXVpbGwuaW1wb3J0KGN1c3RvbU9wdGlvbi5pbXBvcnQpXG4gICAgICBuZXdDdXN0b21PcHRpb24ud2hpdGVsaXN0ID0gY3VzdG9tT3B0aW9uLndoaXRlbGlzdFxuICAgICAgdGhpcy5RdWlsbC5yZWdpc3RlcihcbiAgICAgICAgbmV3Q3VzdG9tT3B0aW9uLFxuICAgICAgICB0cnVlLFxuICAgICAgICB0aGlzLmNvbmZpZy5zdXBwcmVzc0dsb2JhbFJlZ2lzdGVyV2FybmluZ1xuICAgICAgKVxuICAgIH0pXG5cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5yZWdpc3RlckN1c3RvbU1vZHVsZXMoXG4gICAgICB0aGlzLlF1aWxsLFxuICAgICAgdGhpcy5jb25maWcuY3VzdG9tTW9kdWxlcyxcbiAgICAgIHRoaXMuY29uZmlnLnN1cHByZXNzR2xvYmFsUmVnaXN0ZXJXYXJuaW5nXG4gICAgKVxuICB9KS5waXBlKHNoYXJlUmVwbGF5KHsgYnVmZmVyU2l6ZTogMSwgcmVmQ291bnQ6IHRydWUgfSkpXG5cbiAgY29uc3RydWN0b3IoXG4gICAgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoUVVJTExfQ09ORklHX1RPS0VOKSBwdWJsaWMgY29uZmlnOiBRdWlsbENvbmZpZ1xuICApIHtcbiAgICB0aGlzLmRvY3VtZW50ID0gaW5qZWN0b3IuZ2V0KERPQ1VNRU5UKVxuXG4gICAgaWYgKCF0aGlzLmNvbmZpZykge1xuICAgICAgdGhpcy5jb25maWcgPSB7IG1vZHVsZXM6IGRlZmF1bHRNb2R1bGVzIH1cbiAgICB9XG4gIH1cblxuICBnZXRRdWlsbCgpIHtcbiAgICByZXR1cm4gdGhpcy5xdWlsbCRcbiAgfVxuXG4gIC8qKlxuICAgKiBNYXJrZWQgYXMgaW50ZXJuYWwgc28gaXQgd29uJ3QgYmUgYXZhaWxhYmxlIGZvciBgbmd4LXF1aWxsYCBjb25zdW1lcnMsIHRoaXMgaXMgb25seVxuICAgKiBpbnRlcm5hbCBtZXRob2QgdG8gYmUgdXNlZCB3aXRoaW4gdGhlIGxpYnJhcnkuXG4gICAqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgYXN5bmMgcmVnaXN0ZXJDdXN0b21Nb2R1bGVzKFxuICAgIFF1aWxsOiBhbnksXG4gICAgY3VzdG9tTW9kdWxlczogQ3VzdG9tTW9kdWxlW10gfCB1bmRlZmluZWQsXG4gICAgc3VwcHJlc3NHbG9iYWxSZWdpc3Rlcldhcm5pbmc/OiBib29sZWFuXG4gICk6IFByb21pc2U8YW55PiB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY3VzdG9tTW9kdWxlcykpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItY29uc3RcbiAgICAgIGZvciAobGV0IHsgaW1wbGVtZW50YXRpb24sIHBhdGggfSBvZiBjdXN0b21Nb2R1bGVzKSB7XG4gICAgICAgIC8vIFRoZSBgaW1wbGVtZW50YXRpb25gIG1pZ2h0IGJlIGFuIG9ic2VydmFibGUgdGhhdCByZXNvbHZlcyB0aGUgYWN0dWFsIGltcGxlbWVudGF0aW9uLFxuICAgICAgICAvLyBlLmcuIGlmIGl0IHNob3VsZCBiZSBsYXp5IGxvYWRlZC5cbiAgICAgICAgaWYgKGlzT2JzZXJ2YWJsZShpbXBsZW1lbnRhdGlvbikpIHtcbiAgICAgICAgICBpbXBsZW1lbnRhdGlvbiA9IGF3YWl0IGZpcnN0VmFsdWVGcm9tKGltcGxlbWVudGF0aW9uKVxuICAgICAgICB9XG4gICAgICAgIFF1aWxsLnJlZ2lzdGVyKHBhdGgsIGltcGxlbWVudGF0aW9uLCBzdXBwcmVzc0dsb2JhbFJlZ2lzdGVyV2FybmluZylcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gYFF1aWxsYCBjb25zdHJ1Y3RvciBzbyB3ZSdsbCBiZSBhYmxlIHRvIHJlLXVzZSBpdHMgcmV0dXJuIHZhbHVlIGV4Y2VwdCBvZiB1c2luZ1xuICAgIC8vIGBtYXBgIG9wZXJhdG9ycywgZXRjLlxuICAgIHJldHVybiBRdWlsbFxuICB9XG59XG4iXX0=